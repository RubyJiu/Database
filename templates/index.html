<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Books</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* Palette variables (user-defined) */
    :root {
      --rich-black: #001524ff;
      --caribbean-current: #15616dff;
      --papaya-whip: #ffecd1ff;
      --orange-wheel: #ff7d00ff;
      --sienna: #78290fff;
      --paynes-gray: #2f4858;
      /* semantic aliases */
      --bg: var(--caribbean-current);
      --panel: var(--papaya-whip);
      --text: var(--rich-black);
      --accent: var(--sienna);
      --accent-strong: var(--orange-wheel);
      --line: #78290fff33;
      --muted: #78290fff66;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: radial-gradient(1200px 600px at 70% -10%, rgba(94,100,114,0.08), transparent), var(--bg); color: var(--text); }
    .container { max-width: 1000px; margin: 40px auto; padding: 0 16px; }
    .card { background: var(--panel); border: 1px solid var(--line); border-radius: 14px; box-shadow: 0 10px 30px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.35); overflow: hidden; }
    .header { padding: 18px 20px; border-bottom: 1px solid var(--line); display: flex; align-items: center; gap: 10px; }
    .dot { width: 10px; height: 10px; border-radius: 50%; background: var(--accent); box-shadow: 0 0 10px rgba(174,217,224,0.55); }
    .title { font-weight: 600; letter-spacing: 0.2px; }
    .content { padding: 20px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { text-align: left; padding: 12px 10px; border-bottom: 1px solid var(--line); vertical-align: top; }
    th { color: var(--paynes-gray); font-weight: 600; }
    tbody tr:hover { background: rgba(174,217,224,0.25); }
    .price { color: var(--accent-strong); font-weight: 600; }
    .muted { color: var(--muted); }
    .badge { display: inline-block; padding: 2px 8px; border-radius: 999px; background: var(--accent); border: 1px solid var(--paynes-gray); color: #ffffff; font-size: 12px; }
    .error { background: rgba(255,166,158,0.22); border: 1px solid var(--accent-strong); color: var(--paynes-gray); padding: 10px 12px; border-radius: 10px; margin-bottom: 16px; }
    .footer { padding: 12px 20px; color: var(--muted); font-size: 14px; }
    code { background: #fffbe6; border: 1px solid var(--panel); padding: 1px 6px; border-radius: 6px; }
    /* Filter & sort layout */
    .filters { margin-bottom: 16px; }
    .filters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px 14px;
      align-items: end;
    }
    .field { display: flex; flex-direction: column; gap: 6px; }
    .field label { color: var(--paynes-gray); font-size: 13px; }
    .field--wide { grid-column: span 2; }
    @media (max-width: 640px) { .field--wide { grid-column: auto; } }
    input[type="text"], input[type="number"], select {
      background: #fffbe6; border: 1px solid var(--line); color: var(--text); padding: 10px 12px; border-radius: 8px; width: 100%;
    }
    .range { display: grid; grid-template-columns: 1fr auto 1fr; gap: 8px; align-items: center; }
    .range span { color: var(--muted); }
    .actions { grid-column: 1 / -1; display: flex; justify-content: flex-end; gap: 10px; }
    button, .btn { background: var(--accent); border: 1px solid var(--paynes-gray); color: #ffffff; padding: 10px 16px; border-radius: 8px; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; }
    button:hover, .btn:hover { background: var(--paynes-gray); }
    button:focus-visible, .btn:focus-visible, a.reset:focus-visible { outline: 3px solid var(--accent-strong); outline-offset: 2px; }
    a.reset { color: #ffffff; text-decoration: none; padding: 10px 14px; border-radius: 8px; border: 1px solid var(--paynes-gray); background: var(--bg); display: inline-flex; align-items: center; }
    a.reset:hover { background: #fffbe6; border-color: var(--accent); color: var(--paynes-gray); }
    .top-actions { display: flex; justify-content: flex-end; margin-bottom: 12px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <div class="dot"></div>
        <div class="title">Books Catalog</div>
      </div>
      <div class="content">
        {% if error %}
          <div class="error">Database error: {{ error }}</div>
        {% endif %}
        <form method="get" action="{{ url_for('index') }}" class="filters">
          <div class="filters-grid">
            <div class="field field--wide">
              <label for="q">Cari</label>
              <input type="text" id="q" name="q" placeholder="Nama atau Author" value="{{ q }}" />
            </div>
            <div class="field">
              <label for="category_id">Kategori</label>
              <select id="category_id" name="category_id">
                <option value="">Semua</option>
                {% for c in categories %}
                  <option value="{{ c.id }}" {% if category_id|string == c.id|string %}selected{% endif %}>{{ c.name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="field">
              <label>Harga</label>
              <div class="range">
                <input type="number" id="min_price" name="min_price" step="0.01" placeholder="Min" value="{{ min_price }}" />
                <span>â€”</span>
                <input type="number" id="max_price" name="max_price" step="0.01" placeholder="Max" value="{{ max_price }}" />
              </div>
            </div>
            <div class="field">
              <label for="sort">Urutkan berdasarkan</label>
              <select id="sort" name="sort">
                <option value="id" {% if sort == 'id' %}selected{% endif %}>ID</option>
                <option value="name" {% if sort == 'name' %}selected{% endif %}>Name</option>
                <option value="author" {% if sort == 'author' %}selected{% endif %}>Author</option>
                <option value="price" {% if sort == 'price' %}selected{% endif %}>Price</option>
                <option value="category" {% if sort == 'category' %}selected{% endif %}>Category</option>
              </select>
            </div>
            <div class="field">
              <label for="order">Arah</label>
              <select id="order" name="order">
                <option value="asc" {% if order == 'asc' %}selected{% endif %}>ASC</option>
                <option value="desc" {% if order == 'desc' %}selected{% endif %}>DESC</option>
              </select>
            </div>
            <div class="actions">
              <a class="reset" href="{{ url_for('index') }}">Reset</a>
              <button type="submit">Apply</button>
            </div>
          </div>
        </form>

        <div class="top-actions">
          <a class="btn" href="{{ url_for('create_book') }}">+ Tambah Buku</a>
        </div>
        {% if books and books|length > 0 %}
          <table>
            <thead>
              <tr>
                <th style="width:64px">ID</th>
                <th>Name</th>
                <th>Author</th>
                <th style="width:120px">Price</th>
                <th style="width:150px">Category</th>
                <th>Description</th>
                <th style="width:180px">Aksi</th>
              </tr>
            </thead>
            <tbody>
              {% for b in books %}
                <tr>
                  <td class="muted">{{ b.id }}</td>
                  <td>{{ b.name }}</td>
                  <td class="muted">{{ b.author }}</td>
                  <td class="price">${{ '%.2f'|format(b.price) }}</td>
                  <td><span class="badge">{{ b.category }}</span></td>
                  <td class="muted">{{ b.description }}</td>
                  <td>
                    <a class="btn" href="{{ url_for('edit_book', book_id=b.id) }}" style="margin-right: 6px;">Edit</a>
                    <form method="post" action="{{ url_for('delete_book', book_id=b.id) }}" style="display:inline" onsubmit="return confirm('Hapus buku ini?');">
                      <button type="submit">Delete</button>
                    </form>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <div class="muted">No books found. Make sure your database is created and seeded. <a class="btn" style="margin-left:8px;" href="{{ url_for('create_book') }}">+ Tambah Buku</a></div>
        {% endif %}
      </div>
    </div>
  </div>
</body>
</html>
